<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>agiliq_blog - django</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">agiliq_blog </a></h1>
                <nav><ul>
                    <li><a href="/category/html.html">html</a></li>
                    <li><a href="/category/markdown.html">markdown</a></li>
                    <li><a href="/category/rst.html">rst</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/when-and-how-use-django-listview.html">When and how to use Django ListView</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-12-29T00:06:39+05:30">
                Published: Fri 29 December 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-12-29T11:36:39+05:30">
                Updated: Fri 29 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info --><h3>When to use ListView?</h3>
<p>Django provides several class based generic views to accomplish common tasks. One among them is ListView. Our <a href="http://agiliq.com/blog/2017/12/when-and-how-use-django-templateview/" target="_blank">last post</a> was on TemplateView.</p>
<p>ListView <strong>should be used</strong> when you want to present a list of objects in a html page.</p>
<p>ListView <strong>shouldn't be used</strong> when your page has forms and does creation or update of objects.</p>
<p>TemplateView can achieve everything which ListView can, but ListView avoids a lot of boilerplate code which would be needed with TemplateView.</p>
<p>Let's write a view using base view <strong>View</strong> and then modify it to use TemplateView and then to use ListView. ListView would help us avoid several lines of code and would also provide better separation of concern.</p>
<h3>Vanilla View</h3>
<p>Assume there is a model called Book which looks like:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Book</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Model</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">CharField</span><span class="p">(</span><span class="nx">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="nx">author_name</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">CharField</span><span class="p">(</span><span class="nx">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>


<p>We want to have a page which shows all the books in the database. View would look like:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">BookListView</span><span class="p">(</span><span class="nx">View</span><span class="p">)</span><span class="o">:</span>

    <span class="nx">def</span> <span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">books</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
        <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;books&#39;</span><span class="o">:</span> <span class="nx">books</span><span class="p">}</span>
        <span class="k">return</span> <span class="nx">render</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="s2">&quot;book-list.html&quot;</span><span class="p">,</span> <span class="nx">context</span><span class="o">=</span><span class="nx">context</span><span class="p">)</span>
</pre></div>


<p>book-list.html looks like the following:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="k">in</span> <span class="nv">books</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span><span class="nv">book.name</span><span class="cp">}}</span><span class="x"></span>
<span class="x">  &lt;br/&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>


<h4>By subclassing TemplateView</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">BookListView</span><span class="p">(</span><span class="nx">TemplateView</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">template_name</span> <span class="o">=</span> <span class="s1">&#39;book-list.html&#39;</span>

    <span class="nx">def</span> <span class="nx">get_context_data</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">context</span> <span class="o">=</span> <span class="kr">super</span><span class="p">(</span><span class="nx">BookListView</span><span class="p">,</span> <span class="nx">self</span><span class="p">).</span><span class="nx">get_context_data</span><span class="p">(</span><span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
        <span class="nx">context</span><span class="p">[</span><span class="s1">&#39;books&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="nx">context</span>
</pre></div>


<p>As discussed in last post on TemplateView, we didn't have to provide a get() implementation and bother with render() while using TemplateView. All that was taken care of by TemplateView.</p>
<h4>By subclassing ListView</h4>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic.list</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;book-list.html&#39;</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
</pre></div>


<p>ListView removes more boilerplate from TemplateView. With ListView we didn't have to bother with get_context_data() implementation. ListView takes care of setting context variable 'books' with the queryset we defined on BookListView.</p>
<p>We can also add filtering in ListView.queryset.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">BookListView</span><span class="p">(</span><span class="nx">ListView</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">template_name</span> <span class="o">=</span> <span class="s1">&#39;book-list.html&#39;</span>
    <span class="nx">queryset</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;A Feast for Crows&#39;</span><span class="p">)</span>
    <span class="nx">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
</pre></div>


<p>Had we wanted pagination, we would have had to add several lines of code in TemplateView or vanilla View implementation. ListView provides pagination for free, we don't have to add pagination code.</p>
<p>Pagination can be added to ListView subclasses by setting a variable <code>paginate_by</code></p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">BookListView</span><span class="p">(</span><span class="nx">ListView</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">template_name</span> <span class="o">=</span> <span class="s1">&#39;book-list.html&#39;</span>
    <span class="nx">queryset</span> <span class="o">=</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
    <span class="nx">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
    <span class="nx">paginate_by</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>


<p>After this <strong>/books-list/?page=1</strong> will return first 10 books. <strong>/books-list/?page=2</strong> will return next 10 books and so on.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/when-and-how-use-django-templateview.html" rel="bookmark"
                           title="Permalink to When and how to use Django TemplateView">When and how to use Django TemplateView</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-12-29T00:00:27+05:30">
                Published: Fri 29 December 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-12-29T11:30:27+05:30">
                Updated: Fri 29 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p>When and how to use Django TemplateView</p>
                <a class="readmore" href="/when-and-how-use-django-templateview.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/adventures-in-advanced-django-orm-with-hyperloglog.html" rel="bookmark"
                           title="Permalink to Adventures in advanced Django ORM with HyperLogLog">Adventures in advanced Django ORM with HyperLogLog</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-12-11T11:24:38+05:30">
                Published: Mon 11 December 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-12-11T22:54:38+05:30">
                Updated: Mon 11 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/shabda.html">shabda</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p>Counting distinct object is a common operation. Most databases and Django make its quite simple to do so. Given appropriate tables or models you would be doing something like select event_type, count(distinct user_id) from github_events group by 1; With appropriateley defined Django model you would do GithubEvents.objects.values( "event_type" ).annotate( distinct_user_count=Count( "user_id", distinct=True ) ) Count distinct is however <a href="https://en.wikipedia.org/wiki/Count-distinct_problem">quite slow on large datasets</a>. There are a few faster methods which give an approximate count in much less time. HyperLogLog is one of the most common methods. We will try implemnting that in Django ORM without going to raw SQL and</p>
                <a class="readmore" href="/adventures-in-advanced-django-orm-with-hyperloglog.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/django-20-window-expressions-tutorial.html" rel="bookmark"
                           title="Permalink to Django 2.0 Window expressions tutorial">Django 2.0 Window expressions tutorial</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-12-06T05:22:38+05:30">
                Published: Wed 06 December 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-12-06T16:52:38+05:30">
                Updated: Wed 06 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/shabda.html">shabda</a>
        </address>
<p>In <a href="/category/rst.html">rst</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p class="first last"><tt class="docutils literal">`python from django.db.models import Avg, F, Window from django.db.models.functions import DenseRank, CumeDist from django_commits.models import Committer import pandas `</tt> <tt class="docutils literal">`python def as_table(values_queryset): pandas.options.display.max_rows=20 return pandas.DataFrame(list(values_queryset)) `</tt> <tt class="docutils literal">`python # Find out who have been the most prolific contributors since the years <span class="pre">2010-2017</span> dense_rank_by_year = Window( <span class="pre">expression=DenseRank(),</span> <span class="pre">partition_by=F(&quot;commit_year&quot;),</span> <span class="pre">order_by=F(&quot;commits_count&quot;).desc()</span> ) commiters_with_rank = Committer.objects.filter( commit_year__gte=2010, commits_count__gte=10 ).annotate( the_rank=dense_rank_by_year ).order_by( <span class="pre">&quot;-commit_year&quot;,</span> &quot;the_rank&quot; ).values( &quot;author&quot;, &quot;commit_year&quot;, &quot;commits_count&quot;, &quot;the_rank&quot; ) as_table(commiters_with_rank) `</tt> &lt;div&gt; &lt;style scoped&gt; .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/style&gt; &lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt; &lt;thead&gt; &lt;tr style=&quot;text-align: right;&quot;&gt;</p>

                <a class="readmore" href="/django-20-window-expressions-tutorial.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/configure-django-log-exceptions-production.html" rel="bookmark"
                           title="Permalink to Configure Django to log exceptions in production">Configure Django to log exceptions in production</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-12-02T00:49:18+05:30">
                Published: Sat 02 December 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-12-02T08:19:18+05:30">
                Updated: Sat 02 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p>Configure Django to log exceptions in production</p>
                <a class="readmore" href="/configure-django-log-exceptions-production.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/template-fragment-caching-gotchas.html" rel="bookmark"
                           title="Permalink to Template fragment caching gotchas">Template fragment caching gotchas</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-08-06T00:42:19+05:30">
                Published: Thu 06 August 2015
        </abbr>
		<br />
        <abbr class="modified" title="2015-08-06T11:12:19+05:30">
                Updated: Thu 06 August 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <h4>Variables in cached template fragment Assuming this is in template. {% cache 300 nums %} {% for i in nums %} <p>i</p> {% endfor %} {% endcache %} And assuming we send {'nums': range(100)} from context, then 0 to 99 will be sent in the response. Now suppose we change context to {'nums': range(1000)}, still for next 5 minutes i.e until the cache expires, 0 to 99 will be sent in the response. 0 to 999 will not be sent in the response. To fix this, we should use the variable too with the {% cache %} tag. So</h4>
                <a class="readmore" href="/template-fragment-caching-gotchas.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/django-timezones.html" rel="bookmark"
                           title="Permalink to Django timezones">Django timezones</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-08-20T00:00:01+05:30">
                Published: Wed 20 August 2014
        </abbr>
		<br />
        <abbr class="modified" title="2014-08-20T10:30:01+05:30">
                Updated: Wed 20 August 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p>This post tries to clear various concepts related to Django timezones. Settings relevant to timezone are TIME_ZONE and USE_TZ. We will see various scenarios with different values for these settings and will figure out how TIME_ZONE and USE_TZ behave. Once though this post, you will stop playing guessing games with Django timezones. ### Concept of timezone Every country is at a different position on Earth and all countries do not face the Sun at the same instant. India and United States are almost on opposite sides of each other on Earth. When India faces the Sun, USA doesn't face it.</p>
                <a class="readmore" href="/django-timezones.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/passing-parameters-to-django-admin-action.html" rel="bookmark"
                           title="Permalink to Passing parameters to Django admin action">Passing parameters to Django admin action</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-08-05T10:33:06+05:30">
                Published: Tue 05 August 2014
        </abbr>
		<br />
        <abbr class="modified" title="2014-08-05T21:03:06+05:30">
                Updated: Tue 05 August 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p>This post will show how to pass parameters to custom Django admin actions. This post assumes that you have an idea of <a href="https://docs.djangoproject.com/en/dev/ref/contrib/admin/actions/" target="_blank">Django actions.</a> Django provides a default admin action which is 'Delete selected rows'. Changelist page for all the models registered with admin has this action available. This action allows to select multiple rows and delete them in a single POST request. ### Problem statement We want to allow following Django action from admin. * There is a model called <strong>Instrument</strong>. It has a field <strong>price</strong> * Allow selecting multiple rows for this model and update the</p>
                <a class="readmore" href="/passing-parameters-to-django-admin-action.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/django-backward-relationship-lookup.html" rel="bookmark"
                           title="Permalink to Django backward relationship lookup">Django backward relationship lookup</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-04-28T00:00:01+05:30">
                Published: Mon 28 April 2014
        </abbr>
		<br />
        <abbr class="modified" title="2014-04-28T10:30:01+05:30">
                Updated: Mon 28 April 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/akshar.html">akshar</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <h2>Django backward relationship lookup I will discuss the intuitive way which most non-advanced Django users use and a slightly unintuitive way which many of us are not aware about. Consider the following relationship: class Group(models.Model): name = models.CharField(max_length=100) class Student(models.Model): name = models.CharField(max_length=100) group = models.ForeignKey(Group) A group can have many students. We want to get the groups based on certain conditions on model <code>Student</code>. If you can get it using model <code>Group</code>, you can skip this post. In such a scenario, we tend to use <code>Student</code> model. It's more intuitive because the Foreign Key relationship exists from Student</h2>
                <a class="readmore" href="/django-backward-relationship-lookup.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/easy-client-side-form-validations-for-django-djang.html" rel="bookmark"
                           title="Permalink to Easy client side form validations for Django: Django Parsley">Easy client side form validations for Django: Django Parsley</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-02-07T00:00:00+05:30">
                Published: Thu 07 February 2013
        </abbr>
		<br />
        <abbr class="modified" title="2013-02-07T11:30:00+05:30">
                Updated: Thu 07 February 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/shabda.html">shabda</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/django.html">django</a> </p>
</footer><!-- /.post-info -->                <p><a href="http://parsleyjs.org/">Parsleyjs</a> is a JavaScript library to do client side data validations. It does this in a non-intrusive way via adding a <code>data-*</code> attributes to form fields. Check it out, it's really slick. Django forms do a great job of server side data validations. By integrating Parsley with Django form, you get good client side data validations as well. Get the <a href="https://github.com/agiliq/django-parsley">app here</a>. ### Some design considerations When I started writing this app I wanted to make it really easy to use. My first thought was to make this a filter or a template tag which would have allowed you to</p>
                <a class="readmore" href="/easy-client-side-form-validations-for-django-djang.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 2
        <a href="/tag/django2.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>