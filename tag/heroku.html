<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>agiliq_blog - heroku</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">agiliq_blog </a></h1>
                <nav><ul>
                    <li><a href="/category/html.html">html</a></li>
                    <li><a href="/category/markdown.html">markdown</a></li>
                    <li><a href="/category/rst.html">rst</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/heroku-django-s3-for-serving-media-files.html">Heroku Django S3 for serving Media files</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-06-04T21:47:35+05:30">
                Published: Wed 04 June 2014
        </abbr>
		<br />
        <abbr class="modified" title="2014-06-05T08:17:35+05:30">
                Updated: Thu 05 June 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/manjunath.html">manjunath</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>
<p>tags: <a href="/tag/heroku.html">heroku</a> </p>
</footer><!-- /.post-info --><h3>Why should i store my media files on AWS S3?</h3>
<p>Heroku dynos have limited life span, and when they die and get replaced, the files within them are lost. So you should set up Django media handler to put the files somewhere permanent.</p>
<h3>Let's begin:</h3>
<p>1) Install dependencies:</p>
<div class="highlight"><pre><span></span>$ pip install django-storages boto
</pre></div>


<p>(Update your <code>requirements.txt using <code>pip freeze &gt; requirements.txt</code>)</p>
<p>2) Update <code>INSTALLED_APPS</code> in your settings.py:</p>
<div class="highlight"><pre><span></span>INSTALLED_APPS += (&#39;storages&#39;,)
</pre></div>


<p>3) Sign in to <a href="http://aws.amazon.com/console/">AWS Console</a>, select <code>S3</code> under <code>Storage &amp; Content Delivery</code> and create a bucket.</p>
<p>4) Don't forget to generate <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>.</p>
<p>5) Add the below to your settings file:</p>
<div class="highlight"><pre><span></span>AWS_QUERYSTRING_AUTH = False
AWS_ACCESS_KEY_ID = os.environ[&#39;AWS_ACCESS_KEY_ID&#39;]
AWS_SECRET_ACCESS_KEY = os.environ[&#39;AWS_SECRET_ACCESS_KEY&#39;]
AWS_STORAGE_BUCKET_NAME = os.environ[&#39;S3_BUCKET_NAME&#39;]
MEDIA_URL = &#39;http://%s.s3.amazonaws.com/your-folder/&#39; % AWS_STORAGE_BUCKET_NAME
DEFAULT_FILE_STORAGE = &quot;storages.backends.s3boto.S3BotoStorage&quot;
</pre></div>


<p>Note: You should never expose your <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> there is some reason why they are called SECRET.</p>
<p>6) Install <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-set-up.html">AWS CLI</a> on your machine.</p>
<p>7) Its time to move your files to AWS S3 bucket.</p>
<div class="highlight"><pre><span></span>$ aws s3 cp myfolder s3://mybucket/myfolder --recursive
</pre></div>


<p>8) After the previous step you can use the following command to view the contents of your bucket.</p>
<div class="highlight"><pre><span></span>$ aws s3 ls s3://mybucket
</pre></div>


<p>9) Grant public-read permission to everyone, add the below to your S3 bucket policy.</p>
<div class="highlight"><pre><span></span>{
  &quot;Version&quot;:&quot;2008-10-17&quot;,
  &quot;Statement&quot;:[{
    &quot;Sid&quot;:&quot;AllowPublicRead&quot;,
        &quot;Effect&quot;:&quot;Allow&quot;,
      &quot;Principal&quot;: {
            &quot;AWS&quot;: &quot;*&quot;
         },
      &quot;Action&quot;:[&quot;s3:GetObject&quot;],
      &quot;Resource&quot;:[&quot;arn:aws:s3:::bucket/*&quot;
      ]
    }
  ]
}
</pre></div>


<p>You can also grant full access to specific IP addresses check this <a href="http://s3browser.com/working-with-amazon-s3-bucket-policies.php">Bucket Policies</a></p>
<p>Thats it now your django app should be able to serve your media files.If not please check your bucket policy, you can check the url link under S3 Management Console-&gt;Properties.</p>
<p>Any problem or feedback? feel free to leave your comments below.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>